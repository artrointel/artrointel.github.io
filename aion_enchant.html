<!DOCTYPE html>
<html>
	<link type="text/css" rel="stylesheet" id="dark-mode-custom-link">
	<link type="text/css" rel="stylesheet" id="dark-mode-general-link">
	<style lang="en" type="text/css" id="dark-mode-custom-style">

	</style>
	<style lang="en" type="text/css" id="dark-mode-native-style">

	</style>
	<style lang="en" type="text/css" id="dark-mode-native-sheet">

	</style>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<script>
			var startEnchant = 0;
			var endEnchant = 0;
			var eChance10 = 0;
			var eCost10 = 0;
			var eChance11 = 0;
			var eCost11 = 0;
			var eChance12 = 0;
			var eCost12 = 0;
			var eChance15 = 0;
			var eCost15 = 0;
			var nSimulation = 0;

			var currEnchant = 0;
			var currAccumCost = 0;

			var avrEnchantCost = 0;
			var minEnchantCost = Number.MAX_SAFE_INTEGER;
			var maxEnchantCost = 0;

			var lToggle = false;

			var logArea = null;
			var worker = null;

			function log(str) {
				logArea.value += str + '\r\n';
			}

			function initialize() {
				if (worker != null)
					worker.terminate();

				startEnchant = parseInt(document.getElementById("startEnchant").value);
				endEnchant = parseInt(document.getElementById("endEnchant").value);

				eChance10 = parseFloat(document.getElementById("eChance10").value);
				eCost10 = parseInt(document.getElementById("eCost10").value);
				eChance11 = parseFloat(document.getElementById("eChance11").value);
				eCost11 = parseInt(document.getElementById("eCost11").value);
				eChance12 = parseFloat(document.getElementById("eChance12").value);
				eCost12 = parseInt(document.getElementById("eCost12").value);
				eChance15 = parseFloat(document.getElementById("eChance15").value);
				eCost15 = parseInt(document.getElementById("eCost15").value);
				nSimulation = parseInt(document.getElementById("nSimulation").value);

				if (isNaN(eChance11)) {
					eChance11 = eChance15;
					eCost11 = eCost15;
				}

				if (isNaN(eChance12)) {
					eChance12 = eChance15;
					eCost12 = eCost15;
				}

				avrEnchantCost = 0;
				minEnchantCost = Number.MAX_SAFE_INTEGER;
				maxEnchantCost = 0;

				logArea = document.getElementById("logArea");
				logArea.scrollTop = logArea.scrollHeight;
				logArea.value = "";
			}

			function startSimulation() {
				initialize();

				worker = new Worker("js/aion_enchant_worker.js");
				worker.postMessage([startEnchant, endEnchant, eChance10, eCost10, eChance11, eCost11, eChance12, eCost12, eChance15, eCost15, nSimulation]);
				worker.onmessage = (e) => {
					if (e.data[0] == "LOG" && lToggle) {
							log(e.data[1]);
					}
					else if (e.data[0] == "ITERATION") {
						var cost = e.data[1];
						var iteration = e.data[2];
						avrEnchantCost += cost;
						minEnchantCost = minEnchantCost > cost ? cost : minEnchantCost;
						maxEnchantCost = maxEnchantCost < cost ? cost : maxEnchantCost;
						document.getElementById("progress").innerHTML = iteration + "회차 완료(" + cost + "만원)";

						document.getElementById("avrEnchantCost").value = avrEnchantCost / iteration;
						document.getElementById("minEnchantCost").value = minEnchantCost;
						document.getElementById("maxEnchantCost").value = maxEnchantCost;
					}
				};
			}

			function toggleLog() {
				lToggle = !lToggle;
				if (lToggle) {
					document.getElementById("enableLog").textContent = "강화 로그 끄기";
				} else {
					document.getElementById("enableLog").textContent = "강화 로그 켜기";
				}
				
			}
		</script>
	</head>
	<body>
	<br>Created by 시엘 대공황 (2023.05.20)<br>

	<br>아이온 클래식 강화 시뮬레이터<br>
	<br>
	"It is better to be born lucky than rich." <br>
	<hr>
	<font color="blue">
	<br>
	※시뮬레이션에 사용할 데이터를 입력해주세요.<br>
	<br>
	<table border="0">
		<tbody>
			<tr><td>현재강화수치</td><td><input type="text" value="0" size="3" id="startEnchant" ></td></tr>
			<tr><td>목표강화수치</td><td><input type="text" value="15" size="3" id="endEnchant"></td></tr>
			<tr><td>강화성공확률</td><td><input type="text" value="70" size="3" id="eChance10">(10강 까지)</td></tr>
			<tr><td>강화시도비용</td><td><input type="text" value="250" size="3" id="eCost10">만원</td></tr>
			<tr><td>강화성공확률</td><td><input type="text" value="48.7" size="3" id="eChance15">(10강 부터)</td></tr>
			<tr><td>강화시도비용</td><td><input type="text" value="900" size="3" id="eCost15">만원</td></tr>
			<tr><td>-------------------</td><td>--------------------------</td></tr>
			<tr><td>아래는 선택사항이며,</td><td>비워두면 위 강화확률에 따름</td></tr>
			<tr><td>11강화성공확률</td><td><input type="text" value="-" size="3" id="eChance11">(11강 할때)</td></tr>
			<tr><td>11강화시도비용</td><td><input type="text" value="-" size="3" id="eCost11">만원</td></tr>
			<tr><td>12강화성공확률</td><td><input type="text" value="-" size="3" id="eChance12">(12강 할때)</td></tr>
			<tr><td>12강화시도비용</td><td><input type="text" value="-" size="3" id="eCost12">만원</td></tr>
			<tr><td>시뮬레이션횟수</td><td><input type="text" value="5" size="3" id="nSimulation"></td></tr>
		</tbody>
	</table>
	<button type="button" onclick="startSimulation()">시작!</button>
	<button type="button" id="enableLog" onclick="toggleLog()">강화로그켜기</button>
	</font>
	<hr>
	
	<br>시뮬레이션 결과<br><br>
	<div id="progress"></div><br>
	<table border="0">
		<tbody>
			<tr><td>평균강화비용</td><td><input type="text" size="10" id="avrEnchantCost" value="-">만원</td></tr>
			<tr><td>최소강화비용</td><td><input type="text" size="10" id="minEnchantCost" value="-">만원</td></tr>
			<tr><td>최대강화비용</td><td><input type="text" size="10" id="maxEnchantCost" value="-">만원</td></tr>
		</tbody>
	</table>
	<br>
	<hr>
	아래에 강화 로그가 표시됩니다. <br>
	<textarea id="logArea" style="width: 600px; height: 400px;"></textarea>
	</body>
</html> 