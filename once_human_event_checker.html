<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì›ìŠ¤ íœ´ë¨¼ ì´ë²¤íŠ¸ íƒ€ì´ë¨¸</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');

    :root {
      --bg-color: #f9f9f9;
      --box-bg: #ffffffcc;
      --border-color: #b3d9ff;
      --accent-color: #a7c7e7;
      --text-color: #333;
      --placeholder-color: #00000040;
      --button-bg: linear-gradient(135deg, #a7c7e7, #88aadd);
      --background-image: url('https://www.transparenttextures.com/patterns/stardust.png');
    }
    body.dark {
      --bg-color: #222;
      --box-bg: #333333cc;
      --border-color: #888;
      --accent-color: #d5b3ff;
      --text-color: #eee;
      --placeholder-color: #ffffff40;
      --button-bg: linear-gradient(135deg, #d5b3ff, #bb99ee);
      --background-image: url('https://www.transparenttextures.com/patterns/dark-mosaic.png');
    }
    body {
      font-family: 'Gowun Dodum', sans-serif;
      font-size: 120%;
      padding: 20px;
      background: var(--bg-color) var(--background-image);
      color: var(--text-color);
      position: relative;
      min-height: 100vh;
      background-size: 300px 300px;
      transition: background 0.3s, color 0.3s;
    }
    input, button {
      font-family: 'Gowun Dodum', sans-serif;
      font-size: 100%;
      border: 1px solid var(--border-color);
    }    
    #container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }
    .event-row {
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
      margin-bottom: 10px;
    }
    .complete-btn {
      transition: background-color 0.3s ease;
    }
    .complete-btn:hover {
      background-color: #ccddee;
    }
    .character-box {
      background: var(--box-bg);
      border: px solid var(--border-color);
      border-radius: 20px;
      padding: 15px;
      width: 280px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .character-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }
    .character-name {
      border: 1px solid var(--border-color);
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      border-radius: 8px;
      margin-bottom: 15px;
      width: 100%;
      background: var(--box-bg);
      color: var(--text-color);
    }
    .event-row {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
    }
    .event-main {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }
    .event-icon {
      width: 30px;
      height: 30px;
      margin-right: 4px;
    }
    .event-label {
      width: 90px;
      font-size: 16px;
      color: var(--text-color);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .timer {
      border: 1px solid var(--accent-color);
      border-radius: 8px;
      padding: 5px 8px;
      font-size: 14px;
      width: 60px;
      text-align: center;
      background: var(--box-bg);
    }
    .complete-btn {
      background: #e0e0e0;
      border: 1px solid #999;
      padding: 4px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    .complete-btn:hover {
      background: #ccc;
    }
    .progress-bar {
      margin-top: 5px;
      width: 100%;
      height: 6px;
      background: #ddd;
      border-radius: 4px;
      overflow: hidden;
    }
    .progress {
      height: 100%;
      width: 0%;
      background: var(--accent-color);
      transition: width 1s linear;
    }
    .alarm-toggle {
      display: flex;
      align-items: center;
      margin-top: 15px;
      gap: 6px;
      justify-content: space-between;
    }
    .alarm-toggle input {
      width: 18px;
      height: 18px;
      accent-color: var(--accent-color);
    }
    input::placeholder {
      color: var(--placeholder-color);
      font-style: italic;
    }
    .delete-btn {
      background: #ffaaaa;
      border: 1px solid #cc6666;
      padding: 4px 8px;
      font-size: 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .delete-btn:hover {
      background: #ff8888;
    }
    .add-button, .theme-toggle {
      font-size: 30px;
      height: 60px;
      width: 60px;
      border-radius: 50%;
      background: var(--button-bg);
      border: none;
      color: white;
      cursor: pointer;
      text-align: center;
      line-height: 60px;
      user-select: none;
      position: fixed;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
      z-index: 100;
    }
    .add-button {
      bottom: 20px;
      right: 20px;
    }
    .theme-toggle {
      top: 20px;
      right: 20px;
    }
    .add-button:hover, .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    }
  </style>
</head>
<body>
<div id="container-wrapper">
  <div id="container"></div>
  <button class="add-button" onclick="addCharacterBox()">+</button>
  <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
</div>

<script>
const timers = new Map();

function speak(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = "ko-KR";
  utterance.pitch = 1.3;
  utterance.rate = 1.1;
  utterance.volume = 1.0;
  speechSynthesis.speak(utterance);
}

function resetTimer(el, isReset = false) {
  const timerEl = el.previousElementSibling;
  const eventLabelEl = el.parentElement.querySelector('.event-label');
  const progressBar = el.parentElement.nextElementSibling;
  const progressEl = progressBar.querySelector('.progress');
  const characterName = el.closest('.character-box').querySelector('.character-name').value || 'ìºë¦­í„°';
  const eventLabel = eventLabelEl.textContent;

  const interval = timers.get(timerEl);
  if (interval) clearInterval(interval);

  eventLabelEl.style.opacity = '1';
  timerEl.textContent = '00:00:00';
  progressEl.style.width = '0%';
  progressBar.style.display = 'none';
  el.textContent = 'ì™„ë£Œí•˜ê¸°';

  if (!isReset) {
    const alarmToggle = el.closest('.character-box').querySelector('.alarm-check');
    if (alarmToggle.checked) {
      speak(`${characterName}, ${eventLabel} ì´ë²¤íŠ¸ ê³ ê³ !`);
    }
  }
}

function startTimer(el) {
  const timerEl = el.previousElementSibling;
  const eventLabelEl = el.parentElement.querySelector('.event-label');
  const progressBar = el.parentElement.nextElementSibling;
  const progressEl = progressBar.querySelector('.progress');
  const eventLabel = eventLabelEl.textContent;
  const characterName = el.closest('.character-box').querySelector('.character-name').value || 'ìºë¦­í„°';

  if (el.textContent === 'ì¿¨íƒ€ì„ì¤‘') {
    resetTimer(el, true);
    return;
  }

  eventLabelEl.style.opacity = '0.5';
  progressBar.style.display = 'block';
  el.textContent = 'ì¿¨íƒ€ì„ì¤‘';

  let remaining = 60 * 60;
  const total = remaining;
  const interval = setInterval(() => {
    const h = String(Math.floor(remaining / 3600)).padStart(2, '0');
    const m = String(Math.floor((remaining % 3600) / 60)).padStart(2, '0');
    const s = String(remaining % 60).padStart(2, '0');
    timerEl.textContent = `${h}:${m}:${s}`;
    progressEl.style.width = `${((total - remaining) / total) * 100}%`;
    if (remaining-- <= 0) {
      resetTimer(el);
    }
  }, 1000);
  timers.set(timerEl, interval);
}

function addCharacterBox(name = '') {
  const box = document.createElement('div');
  box.className = 'character-box';
  box.innerHTML = `
    <input class="character-name" type="text" placeholder="ìºë¦­í„°ëª…" value="${name}" onchange="saveCharacterNamesToCookie()" />
    <div class="event-row">
      <div class="event-main">
        <img src="https://icons.iconarchive.com/icons/google/noto-emoji-travel-places/256/42697-fire-icon.png" alt="ì•„ì´ì½˜" class="event-icon" />
        <div class="event-label">ì§€ì˜¥ê¸¸</div>
        <div class="timer">00:00:00</div>
        <button class="complete-btn">ì™„ë£Œí•˜ê¸°</button>
      </div>
      <div class="progress-bar" style="display: none;"><div class="progress"></div></div>
    </div>
    <div class="event-row">
      <div class="event-main">
        <img src="https://icons.iconarchive.com/icons/seanau/user/256/Thief-icon.png" alt="ì•„ì´ì½˜" class="event-icon" />
        <div class="event-label">ì¼€ì´ë¡ </div>
        <div class="timer">00:00:00</div>
        <button class="complete-btn">ì™„ë£Œí•˜ê¸°</button>
      </div>
      <div class="progress-bar" style="display: none;"><div class="progress"></div></div>
    </div>
    <div class="event-row">
      <div class="event-main">
        <img src="https://icons.iconarchive.com/icons/papirus-team/papirus-apps/256/amnesia-the-dark-descent-icon.png" alt="ì•„ì´ì½˜" class="event-icon" />
        <div class="event-label">ë‹¤í¬ì‚¬ì´íŠ¸</div>
        <div class="timer">00:00:00</div>
        <button class="complete-btn">ì™„ë£Œí•˜ê¸°</button>
      </div>
      <div class="progress-bar" style="display: none;"><div class="progress"></div></div>
    </div>
    <div class="event-row">
      <div class="event-main">
        <img src="https://icons.iconarchive.com/icons/mathijssen/tuxlets/256/Devil-Tux-icon.png" alt="ì•„ì´ì½˜" class="event-icon" />
        <div class="event-label">íƒ€ë½í•œë‚™ì›</div>
        <div class="timer">00:00:00</div>
        <button class="complete-btn">ì™„ë£Œí•˜ê¸°</button>
      </div>
      <div class="progress-bar" style="display: none;"><div class="progress"></div></div>
    </div>
    <div class="event-row">
      <div class="event-main">
        <img src="https://icons.iconarchive.com/icons/tanitakawkaw/simple-cute/256/music-icon.png" alt="ì•„ì´ì½˜" class="event-icon" />
        <div class="event-label">ë””ìŠ¤ì½”</div>
        <div class="timer">00:00:00</div>
        <button class="complete-btn">ì™„ë£Œí•˜ê¸°</button>
      </div>
      <div class="progress-bar" style="display: none;"><div class="progress"></div></div>
    </div>
    <div class="alarm-toggle">
      <span><input type="checkbox" class="alarm-check" checked /> <label>ìŒì„± ì•Œë¦¼ ì¼œê¸°</label></span>
      <button class="delete-btn" onclick="deleteCharacterBox(this)">ì‚­ì œ</button>
    </div>
  `;
  box.querySelectorAll('.complete-btn').forEach(btn => {
    btn.addEventListener('click', () => startTimer(btn));
  });
  document.getElementById('container').appendChild(box);
  saveCharacterNamesToCookie();
}

function deleteCharacterBox(btn) {
  const box = btn.closest('.character-box');
  box.remove();
  saveCharacterNamesToCookie();
}

function toggleTheme() {
  document.body.classList.toggle('dark');
}

function saveCharacterNamesToCookie() {
  const names = Array.from(document.querySelectorAll('.character-name')).map(input => input.value);
  document.cookie = `characterNames=${encodeURIComponent(JSON.stringify(names))}; path=/; max-age=31536000`;
}

function loadCharacterNamesFromCookie() {
  const match = document.cookie.match(/(?:^|; )characterNames=([^;]*)/);
  if (match) {
    try {
      const names = JSON.parse(decodeURIComponent(match[1]));
      if (Array.isArray(names)) {
        names.forEach(name => addCharacterBox(name));
        return;
      }
    } catch (e) {
      console.error('ì¿ í‚¤ íŒŒì‹± ì—ëŸ¬:', e);
    }
  }
  addCharacterBox();
}

loadCharacterNamesFromCookie();
</script>
</body>
</html>
