<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ÏõêÏä§ Ìú¥Î®º Ïù¥Î≤§Ìä∏ ÌÉÄÏù¥Î®∏</title>
  <style>@import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');
    :root {
      --bg-color: #f9f9f9;
      --box-bg: #ffffffcc;
      --border-color: #b3d9ff;
      --accent-color: #a7c7e7;
      --text-color: #333;
      --placeholder-color: #00000040;
      --button-bg: linear-gradient(135deg, #a7c7e7, #88aadd);
    }
    body.dark {
      --bg-color: #222;
      --box-bg: #333333cc;
      --border-color: #888;
      --accent-color: #d5b3ff;
      --text-color: #eee;
      --placeholder-color: #ffffff40;
      --button-bg: linear-gradient(135deg, #d5b3ff, #bb99ee);
    }
    body.dark .left-pane,
    body.dark .right-pane {
      background-color: var(--box-bg);
      color: var(--text-color);
    }
    body.dark .memo {
      background-color: var(--box-bg);
      border-color: var(--border-color);
    }
    body.dark .memo-header {
      background-color: #444;
      color: var(--text-color);
    }
    body.dark .memo-content {
      background-color: #333;
      color: var(--text-color);
    }
    body {
      font-family: 'Gowun Dodum', sans-serif;
      font-size: 120%;
      padding: 20px;
      background: var(--bg-color);
      color: var(--text-color);
      position: relative;
      min-height: 100vh;
      background-size: 300px 300px;
      transition: background 0.3s, color 0.3s;
    }
    input, button {
      font-family: 'Gowun Dodum', sans-serif;
      font-size: 100%;
      border: 1px solid var(--border-color);
    }    
    #container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }
    .event-row {
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
      margin-bottom: 10px;
    }
    .complete-btn {
      transition: background-color 0.3s ease;
    }
    .complete-btn:hover {
      background-color: #ccddee;
    }
    .character-box {
      background: var(--box-bg);
      border: px solid var(--border-color);
      border-radius: 20px;
      padding: 15px;
      width: 280px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .character-box:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }
    .character-name {
      border: 1px solid var(--border-color);
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      border-radius: 8px;
      margin-bottom: 15px;
      width: 100%;
      background: var(--box-bg);
      color: var(--text-color);
    }
    .event-row {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
    }
    .event-main {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }
    .event-icon {
      width: 30px;
      height: 30px;
      margin-right: 4px;
    }
    .event-label {
      width: 90px;
      font-size: 16px;
      color: var(--text-color);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .timer {
      border: 1px solid var(--accent-color);
      border-radius: 8px;
      padding: 5px 8px;
      font-size: 14px;
      width: 60px;
      text-align: center;
      background: var(--box-bg);
    }
    .complete-btn {
      background: #e0e0e0;
      border: 1px solid #999;
      padding: 4px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    .complete-btn:hover {
      background: #ccc;
    }
    .progress-bar {
      margin-top: 5px;
      width: 100%;
      height: 6px;
      background: #ddd;
      border-radius: 4px;
      overflow: hidden;
    }
    .progress {
      height: 100%;
      width: 0%;
      background: var(--accent-color);
      transition: width 1s linear;
    }
    .alarm-toggle {
      display: flex;
      align-items: center;
      margin-top: 15px;
      gap: 6px;
      justify-content: space-between;
    }
    .alarm-toggle input {
      width: 18px;
      height: 18px;
      accent-color: var(--accent-color);
    }
    input::placeholder {
      color: var(--placeholder-color);
      font-style: italic;
    }
    .delete-btn {
      background: #ffaaaa;
      border: 1px solid #cc6666;
      padding: 4px 8px;
      font-size: 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .delete-btn:hover {
      background: #ff8888;
    }
    .add-button, .theme-toggle {
      font-size: 30px;
      height: 60px;
      width: 60px;
      border-radius: 50%;
      background: var(--button-bg);
      border: none;
      color: white;
      cursor: pointer;
      text-align: center;
      line-height: 60px;
      user-select: none;
      position: fixed;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
      z-index: 100;
    }
    .add-button {
      bottom: 20px;
      right: 20px;
    }
    .theme-toggle {
      top: 20px;
      right: 20px;
    }
    .add-button:hover, .theme-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    }
    .split-container {
      display: flex;
      width: 100%;
      height: 100vh;
    }
    .pane {
      overflow: auto;
      height: 100%;
    }
    .left-pane {
      width: 35%;
      min-width: 250px;
      background-color: #f5f5f5;
      padding: 10px;
      box-sizing: border-box;
    }
    .right-pane {
      flex: 1;
      padding: 10px;
      background-color: #ffffff;
      box-sizing: border-box;
    }
    .resizer {
      width: 5px;
      cursor: col-resize;
      background-color: #ccc;
    }
    .memo-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
      max-height: calc(100vh - 80px);
    }
    .memo {
      border: 1px solid #ccc;
      border-radius: 6px;
      background-color: #fff;
      overflow: hidden;
      animation: fade-in 0.5s ease;
    }
    .memo-header {
      padding: 5px 10px;
      background: #e0e0e0;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .memo.fade-out {
      animation: fade-out 1s ease forwards;
    }
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fade-out {
      from { opacity: 1; }
      to { opacity: 0; height: 0; margin: 0; padding: 0; }
    }
    .memo-title {
      background: transparent;
      border: none;
      font-size: 14px;
      font-weight: 500;
      height: 24px;
      color: inherit;
    }
    .memo-title:focus {
      outline: 2px solid var(--accent-color);
      background-color: var(--box-bg);
    }
    .memo-header button {
      padding: 2px 8px;
      font-size: 13px;
      height: 28px;
    }
    .memo-content {
      display: none;
      padding: 10px;
    }
    .memo-content.active {
      display: block;
    }
    .quill-editor {
      height: 150px;
    }
    body.dark .ql-toolbar.ql-snow {
      background-color: #444;
      border-color: #666;
    }
    body.dark .ql-toolbar.ql-snow .ql-picker-label,
    body.dark .ql-toolbar.ql-snow .ql-stroke,
    body.dark .ql-toolbar.ql-snow .ql-fill,
    body.dark .ql-toolbar.ql-snow .ql-picker {
      color: #eee;
      stroke: #eee;
      
    }
    body.dark .ql-container.ql-snow {
      background-color: #222;
      border-color: #666;
      color: #eee;
    }
    body.dark .ql-editor {
      color: #eee;
    }
    body.dark .ql-picker {
      color: #eee;
    }
    .add-btn {
      margin-bottom: 10px;
      width: 100%;
      padding: 8px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="split-container">
    <div class="pane left-pane" id="memo-pane">
      <button class="add-btn" onclick="addMemo()">Î©îÎ™® Ï∂îÍ∞Ä</button>
      <div class="memo-list" id="memo-list"></div>
    </div>
    <div class="resizer" id="resizer"></div>
    <div class="pane right-pane" id="event-pane">
      <div id="container"></div>
      <button class="add-button" onclick="addCharacterBox()">+</button>
      <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
    </div>
  </div>

  <!-- Quill Editor -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <script>
    const EVENT_MAP = {
      'ÏºÄÏù¥Î°†': 'https://icons.iconarchive.com/icons/seanau/user/256/Thief-icon.png',
      'Îã§ÌÅ¨ÏÇ¨Ïù¥Ìä∏': 'https://icons.iconarchive.com/icons/papirus-team/papirus-apps/256/amnesia-the-dark-descent-icon.png',
      'ÌÉÄÎùΩÌïúÎÇôÏõê': 'https://icons.iconarchive.com/icons/mathijssen/tuxlets/256/Devil-Tux-icon.png',
      'ÎîîÏä§ÏΩî': 'https://icons.iconarchive.com/icons/tanitakawkaw/simple-cute/256/music-icon.png',
      'ÏßÄÏò•Í∏∏': 'https://icons.iconarchive.com/icons/google/noto-emoji-travel-places/256/42697-fire-icon.png'
    };

    const memos = [];
    let memoId = 0;

    function saveMemosToCookie() {
      const contents = memos.map(q => q.editor.root.innerHTML);
      document.cookie = `memoList=${encodeURIComponent(JSON.stringify(contents))}; path=/; max-age=31536000`;
    }

    function loadMemosFromCookie() {
      const match = document.cookie.match(/(?:^|; )memoList=([^;]*)/);
      if (match) {
        try {
          const list = JSON.parse(decodeURIComponent(match[1]));
          if (Array.isArray(list)) list.forEach(html => addMemo(html));
        } catch (e) {
          console.error('Î©îÎ™® Î°úÎìú Ïò§Î•ò:', e);
        }
      }
    }

    function addMemo(content = '', title = '') {
      const id = `memo-${memoId++}`;
      const memoWrapper = document.createElement('div');
      memoWrapper.className = 'memo';
      memoWrapper.innerHTML = `
        <div class="memo-header" onclick="toggleMemo('${id}')">
          <input class="memo-title" placeholder="Ï†úÎ™© ÏóÜÏùå" value="${title || 'Î©îÎ™® ' + memoId}" oninput="saveMemosToCookie()" onclick="event.stopPropagation()" />
          <button onclick="deleteMemo(event, '${id}')">ÏÇ≠Ï†ú</button>
        </div>
        <div class="memo-content active" id="${id}">
          <div class="quill-editor"></div>
        </div>
      `;
      document.getElementById('memo-list').appendChild(memoWrapper);

      const editor = new Quill(memoWrapper.querySelector('.quill-editor'), {
        theme: 'snow'
      });
      editor.root.innerHTML = content;
      editor.on('text-change', saveMemosToCookie);
      memos.push({ id, editor, titleInput: memoWrapper.querySelector('.memo-title') });
      saveMemosToCookie();
    }

    function saveMemosToCookie() {
      const contents = memos.map(m => ({
        html: m.editor.root.innerHTML,
        title: m.titleInput?.value || ''
      }));
      document.cookie = `memoList=${encodeURIComponent(JSON.stringify(contents))}; path=/; max-age=31536000`;
    }

    function loadMemosFromCookie() {
      const match = document.cookie.match(/(?:^|; )memoList=([^;]*)/);
      if (match) {
        try {
          const list = JSON.parse(decodeURIComponent(match[1]));
          if (Array.isArray(list)) list.forEach(m => addMemo(m.html, m.title));
        } catch (e) {
          console.error('Î©îÎ™® Î°úÎìú Ïò§Î•ò:', e);
        }
      }
    }

    function toggleMemo(id) {
      const content = document.getElementById(id);
      content.classList.toggle('active');
    }

    function deleteMemo(e, id) {
      e.stopPropagation();
      const index = memos.findIndex(m => m.id === id);
      if (index !== -1) memos.splice(index, 1);
      const el = document.getElementById(id).closest('.memo');
      el.classList.add('fade-out');
      setTimeout(() => el.remove(), 1000);
      saveMemosToCookie();
    }

    document.addEventListener('keydown', function (e) {
      if (e.target.classList.contains('memo-title') && e.key === 'Enter') {
        e.preventDefault();
        e.target.blur();
      }
    });

    const resizer = document.getElementById('resizer');
    const leftPane = document.getElementById('memo-pane');
    let isResizing = false;
    resizer.addEventListener('mousedown', (e) => {
      isResizing = true;
      document.addEventListener('mousemove', resizePane);
      document.addEventListener('mouseup', () => {
        isResizing = false;
        document.removeEventListener('mousemove', resizePane);
      });
    });
    function resizePane(e) {
      if (!isResizing) return;
      const width = Math.max(250, e.clientX);
      leftPane.style.width = width + 'px';
    }

    window.addEventListener('DOMContentLoaded', () => {
      loadMemosFromCookie();
    });
      // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ ÌÉÄÏù¥Î®∏ Ïä§ÌÅ¨Î¶ΩÌä∏ ÏãúÏûë
    const timers = new Map();

    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "ko-KR";
      utterance.pitch = 1.5;
      utterance.rate = 1.3;
      utterance.volume = 1.0;
      speechSynthesis.speak(utterance);
    }

    function resetTimer(el, isReset = false) {
      const timerEl = el.previousElementSibling;
      const eventLabelEl = el.parentElement.querySelector('.event-label');
      const progressBar = el.parentElement.nextElementSibling;
      const progressEl = progressBar.querySelector('.progress');
      const characterName = el.closest('.character-box').querySelector('.character-name').value || 'Ï∫êÎ¶≠ÌÑ∞';
      const eventLabel = eventLabelEl.textContent;

      const interval = timers.get(timerEl);
      if (interval) clearInterval(interval);

      eventLabelEl.style.opacity = '1';
      timerEl.textContent = '00:00:00';
      progressEl.style.width = '0%';
      progressBar.style.display = 'none';
      el.textContent = 'ÏôÑÎ£åÌïòÍ∏∞';

      if (!isReset) {
        const alarmToggle = el.closest('.character-box').querySelector('.alarm-check');
        if (alarmToggle.checked) {
          speak(`${characterName}, ${eventLabel} Ïù¥Î≤§Ìä∏ Í≥†Í≥†!`);
        }
      }
    }

    function startTimer(el) {
      const timerEl = el.previousElementSibling;
      const eventLabelEl = el.parentElement.querySelector('.event-label');
      const progressBar = el.parentElement.nextElementSibling;
      const progressEl = progressBar.querySelector('.progress');
      const eventLabel = eventLabelEl.textContent;
      const characterName = el.closest('.character-box').querySelector('.character-name').value || 'Ï∫êÎ¶≠ÌÑ∞';

      if (el.textContent === 'Ïø®ÌÉÄÏûÑÏ§ë') {
        resetTimer(el, true);
        return;
      }

      eventLabelEl.style.opacity = '0.5';
      progressBar.style.display = 'block';
      el.textContent = 'Ïø®ÌÉÄÏûÑÏ§ë';

      const startTimestamp = Date.now();
      const endTimestamp = startTimestamp + 60 * 60 * 1000;

      const interval = setInterval(() => {
        const now = Date.now();
        let remaining = Math.max(0, Math.floor((endTimestamp - now) / 1000));

        const h = String(Math.floor(remaining / 3600)).padStart(2, '0');
        const m = String(Math.floor((remaining % 3600) / 60)).padStart(2, '0');
        const s = String(remaining % 60).padStart(2, '0');
        timerEl.textContent = `${h}:${m}:${s}`;

        progressEl.style.width = `${((3600 - remaining) / 3600) * 100}%`;

        if (remaining <= 0) {
          clearInterval(interval);
          resetTimer(el);
        }
      }, 1000);

      timers.set(timerEl, interval);
    }

    function addCharacterBox(name = '') {
    const box = document.createElement('div');
    box.className = 'character-box';
    box.innerHTML = `
      <input class="character-name" type="text" placeholder="Ï∫êÎ¶≠ÌÑ∞Î™Ö" value="${name}" onchange="saveCharacterNamesToCookie()" />
      ${['ÏßÄÏò•Í∏∏', 'ÏºÄÏù¥Î°†', 'Îã§ÌÅ¨ÏÇ¨Ïù¥Ìä∏', 'ÌÉÄÎùΩÌïúÎÇôÏõê', 'ÎîîÏä§ÏΩî'].map(label => `
        <div class="event-row">
          <div class="event-main">
            <img src="${EVENT_MAP[label] || ''}" alt="ÏïÑÏù¥ÏΩò" class="event-icon" />
            <div class="event-label">${label}</div>
            <div class="timer">00:00:00</div>
            <button class="complete-btn">ÏôÑÎ£åÌïòÍ∏∞</button>
          </div>
          <div class="progress-bar" style="display: none;"><div class="progress"></div></div>
        </div>
      `).join('')}
      <div class="alarm-toggle">
        <span><input type="checkbox" class="alarm-check" checked /> <label>ÏùåÏÑ± ÏïåÎ¶º ÏºúÍ∏∞</label></span>
        <button class="delete-btn" onclick="deleteCharacterBox(this)">ÏÇ≠Ï†ú</button>
      </div>
    `;
    box.querySelectorAll('.complete-btn').forEach(btn => {
      btn.addEventListener('click', () => startTimer(btn));
    });
    document.getElementById('container').appendChild(box);
    saveCharacterNamesToCookie();
  }

    function deleteCharacterBox(btn) {
      const box = btn.closest('.character-box');
      box.remove();
      saveCharacterNamesToCookie();
    }

    function toggleTheme() {
      const isDark = document.body.classList.toggle('dark');
      document.cookie = `theme=${isDark ? 'dark' : 'light'}; path=/; max-age=31536000`;
    }

    function saveCharacterNamesToCookie() {
      const names = Array.from(document.querySelectorAll('.character-name')).map(input => input.value);
      document.cookie = `characterNames=${encodeURIComponent(JSON.stringify(names))}; path=/; max-age=31536000`;
    }

    function loadCharacterNamesFromCookie() {
      const match = document.cookie.match(/(?:^|; )characterNames=([^;]*)/);
      if (match) {
        try {
          const names = JSON.parse(decodeURIComponent(match[1]));
          if (Array.isArray(names)) {
            names.forEach(name => addCharacterBox(name));
            return;
          }
        } catch (e) {
          console.error('Ïø†ÌÇ§ ÌååÏã± ÏóêÎü¨:', e);
        }
      }
      addCharacterBox();
    }

    (function loadThemeFromCookie() {
      const match = document.cookie.match(/(?:^|; )theme=([^;]*)/);
      if (match && match[1] === 'dark') {
        document.body.classList.add('dark');
      }
    })();

    window.addEventListener('DOMContentLoaded', () => {
      loadCharacterNamesFromCookie();
      loadMemosFromCookie();
    });
    // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ ÌÉÄÏù¥Î®∏ Ïä§ÌÅ¨Î¶ΩÌä∏ ÎÅù
  </script>
</body>
</html>
